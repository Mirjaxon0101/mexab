<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Sayt</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-500 to-purple-600 min-h-screen flex flex-col items-center text-white">

  <!-- Navbar -->
  <header class="w-full p-4 bg-black/30 backdrop-blur-md fixed top-0 left-0 flex justify-between items-center shadow-lg z-40">
    <h1 class="text-2xl font-bold">Chat Sayt</h1>
    <div class="space-x-2">
      <button onclick="openSignup()" class="px-4 py-2 bg-green-500 rounded-xl">Roâ€˜yxatdan oâ€˜tish</button>
      <button onclick="openLogin()" class="px-4 py-2 bg-white text-black rounded-xl">Kirish</button>
    </div>
  </header>

  <!-- Asosiy -->
  <main class="text-center mt-32 w-full max-w-3xl px-6">
    <h2 class="text-5xl font-extrabold">Xush kelibsiz!</h2>
    <p class="mt-4 text-lg">Roâ€˜yxatdan oâ€˜ting yoki kirib chatni boshlang ðŸš€</p>
  </main>

  <!-- Chat ekran -->
  <div id="chatScreen" class="hidden fixed inset-0 bg-gradient-to-r from-gray-900 via-purple-900 to-black flex z-30">
    <!-- Foydalanuvchilar -->
    <aside class="w-72 bg-black/50 p-4 border-r border-gray-700 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold">Foydalanuvchilar</h2>
      </div>
      <ul id="userList" class="space-y-3 text-gray-200"></ul>
    </aside>

    <!-- Chat -->
    <div class="flex-1 flex flex-col">
      <header class="p-4 bg-black/40 text-white flex justify-between items-center">
        <h2 class="text-xl font-bold">Chat</h2>
        <button onclick="logout()" class="px-3 py-1 bg-red-600 rounded-lg">Chiqish</button>
      </header>
      <div id="messages" class="flex-1 p-6 overflow-y-auto space-y-3"></div>
      <footer class="p-4 bg-black/40 flex gap-2">
        <input id="messageInput" type="text" placeholder="Xabar yozing..."
          class="flex-1 px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button onclick="sendMessage()" class="px-4 py-2 bg-purple-600 rounded-lg">Yubor</button>
      </footer>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  // ðŸ”¥ Firebase config (o'zingniki bilan almashtir)
  const firebaseConfig = {
    apiKey: "AIzaSyCg3pemPiNzltp5GulkwWGmoEFRJ0BYVcA",
    authDomain: "chat-sayt.firebaseapp.com",
    projectId: "chat-sayt",
    storageBucket: "chat-sayt.firebasestorage.app",
    messagingSenderId: "310136336599",
    appId: "1:310136336599:web:956bb81e764a6643cd0092",
    measurementId: "G-1BEZGKXR0E"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;

  // Ro'yxatdan oâ€˜tish
  window.openSignup = function() {
    const name = prompt("Ismingiz:");
    if (!name) return;
    currentUser = name;
    document.getElementById("chatScreen").classList.remove("hidden");
    loadMessages();
    loadUsers();
  }

  // Kirish
  window.openLogin = function() {
    const name = prompt("Ismingiz:");
    if (!name) return;
    currentUser = name;
    document.getElementById("chatScreen").classList.remove("hidden");
    loadMessages();
    loadUsers();
  }

  // Chiqish
  window.logout = function() {
    currentUser = null;
    document.getElementById("chatScreen").classList.add("hidden");
  }

  // Xabar yuborish
  window.sendMessage = async function() {
    const input = document.getElementById("messageInput");
    const text = input.value.trim();
    if (!text || !currentUser) return;
    await addDoc(collection(db, "messages"), {
      user: currentUser,
      text,
      time: Date.now()
    });
    input.value = "";
  }

  // Xabarlarni yuklash
  function loadMessages() {
    const q = query(collection(db, "messages"), orderBy("time"));
    onSnapshot(q, (snapshot) => {
      const messagesDiv = document.getElementById("messages");
      messagesDiv.innerHTML = "";
      snapshot.forEach((doc) => {
        const m = doc.data();
        const div = document.createElement("div");
        div.className = "flex " + (m.user === currentUser ? "justify-end" : "justify-start");
        div.innerHTML = `<div class="px-4 py-2 rounded-2xl max-w-xs ${m.user===currentUser?'bg-purple-600':'bg-gray-700'} text-white shadow">
          <strong>${m.user}</strong><br>${m.text}
        </div>`;
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }

  // Foydalanuvchilar roâ€˜yxati
  function loadUsers() {
    const userList = document.getElementById("userList");
    userList.innerHTML = "";
    const li = document.createElement("li");
    li.innerHTML = `<span class="bg-green-600 w-3 h-3 rounded-full inline-block mr-2"></span>${currentUser}`;
    userList.appendChild(li);
  }
</script>
</body>
</html>
