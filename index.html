<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Sayt — Profil</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-500 to-purple-600 min-h-screen flex flex-col items-center text-white">

  <!-- Navbar -->
  <header class="w-full p-4 bg-black/30 backdrop-blur-md fixed top-0 left-0 flex justify-between items-center shadow-lg z-40">
    <h1 class="text-2xl font-bold">Chat Sayt</h1>
    <div class="space-x-2">
      <button onclick="openSignup()" class="px-4 py-2 bg-green-500 text-white rounded-xl font-semibold hover:bg-green-600 transition">
        Ro‘yxatdan o‘tish
      </button>
      <button onclick="openLogin()" class="px-4 py-2 bg-white text-black rounded-xl font-semibold hover:bg-gray-200 transition">
        Kirish
      </button>
    </div>
  </header>

  <!-- Asosiy content -->
  <main class="text-center mt-32 w-full max-w-3xl px-6">
    <h2 class="text-5xl font-extrabold drop-shadow-lg">Xush kelibsiz!</h2>
    <p class="mt-4 text-lg">Ro‘yxatdan o‘ting yoki kirib chatni boshlang. Profil sozlamalarida rasm yuklashingiz, parolni o'zgartirishingiz va akkauntingizni o'chirishingiz mumkin.</p>
  </main>

  <!-- Signup modal -->
  <div id="signupModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
    <div class="bg-white text-black p-6 rounded-2xl w-96 shadow-2xl relative">
      <button onclick="closeSignup()" class="absolute top-3 right-3 text-gray-500 hover:text-red-600 text-xl font-bold">✕</button>
      <h2 class="text-2xl font-bold mb-4">Ro‘yxatdan o‘tish</h2>

      <label class="block text-sm text-gray-600 mb-1">Ism</label>
      <input id="signupName" type="text" placeholder="Ismingiz"
        class="w-full px-3 py-2 border rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-green-500">

      <label class="block text-sm text-gray-600 mb-1">Parol</label>
      <input id="signupPass" type="password" placeholder="Parol"
        class="w-full px-3 py-2 border rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-green-500">

      <label class="block text-sm text-gray-600 mb-1">Profil rasmi (ixtiyoriy)</label>
      <input id="signupAvatar" type="file" accept="image/*" class="w-full mb-4">

      <button onclick="signup()" class="w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
        Ro‘yxatdan o‘tish
      </button>
    </div>
  </div>

  <!-- Login modal -->
  <div id="loginModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
    <div class="bg-white text-black p-6 rounded-2xl w-96 shadow-2xl relative">
      <button onclick="closeLogin()" class="absolute top-3 right-3 text-gray-500 hover:text-red-600 text-xl font-bold">✕</button>
      <h2 class="text-2xl font-bold mb-4">Kirish</h2>
      <label class="block text-sm text-gray-600 mb-1">Ism</label>
      <input id="loginName" type="text" placeholder="Ismingiz"
        class="w-full px-3 py-2 border rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
      <label class="block text-sm text-gray-600 mb-1">Parol</label>
      <input id="loginPass" type="password" placeholder="Parol"
        class="w-full px-3 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500">
      <div class="flex gap-2">
        <button onclick="login()" class="flex-1 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">Kirish</button>
        <button onclick="switchToSignup()" class="flex-1 py-2 bg-gray-200 text-black rounded-lg hover:bg-gray-300 transition">Ro‘yxatdan</button>
      </div>
    </div>
  </div>

  <!-- Profile modal (faqat UI qoladi, login/signup local bo‘lib qoladi) -->
  <div id="profileModal" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-50">
    <div class="bg-white text-black p-6 rounded-2xl w-96 shadow-2xl relative">
      <button onclick="closeProfile()" class="absolute top-3 right-3 text-gray-500 hover:text-red-600 text-xl font-bold">✕</button>
      <h2 class="text-2xl font-bold mb-3">Profil sozlamalari</h2>
      <div id="profileNameDisplay" class="mb-3"></div>
      <button onclick="deleteAccount()" class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Akkauntni o'chirish</button>
    </div>
  </div>

  <!-- Fullscreen chat -->
  <div id="chatScreen" class="hidden fixed inset-0 bg-gradient-to-r from-gray-900 via-purple-900 to-black flex z-30">
    <aside class="w-72 bg-black/50 p-4 border-r border-gray-700 overflow-y-auto">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold">Foydalanuvchilar</h2>
        <div>
          <button id="openProfileBtn" onclick="openProfile()" class="px-3 py-1 bg-indigo-600 rounded-lg text-sm hover:bg-indigo-700">Profil</button>
        </div>
      </div>
      <ul id="userList" class="space-y-3 text-gray-200"></ul>
    </aside>

    <div class="flex-1 flex flex-col">
      <header class="p-4 bg-black/40 text-white flex justify-between items-center">
        <h2 class="text-xl font-bold">Chat</h2>
        <button onclick="closeChat()" class="px-3 py-1 bg-red-600 rounded-lg hover:bg-red-700 transition">Chiqish</button>
      </header>
      <div id="messages" class="flex-1 p-6 overflow-y-auto space-y-3"></div>
      <footer class="p-4 bg-black/40 flex gap-2">
        <input id="messageInput" type="text" placeholder="Xabar yozing..."
          class="flex-1 px-3 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500">
        <button onclick="sendMessage()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">Yubor</button>
      </footer>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCg3pemPiNzltp5GulkwWGmoEFRJ0BYVcA",
    authDomain: "chat-sayt.firebaseapp.com",
    projectId: "chat-sayt",
    storageBucket: "chat-sayt.firebasestorage.app",
    messagingSenderId: "310136336599",
    appId: "1:310136336599:web:956bb81e764a6643cd0092",
    measurementId: "G-1BEZGKXR0E"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;

  /* === Ro‘yxatdan o‘tish === */
  window.signup = function() {
    const name = document.getElementById("signupName").value.trim();
    const pass = document.getElementById("signupPass").value.trim();
    if(!name || !pass) return alert("Ism va parol kiriting!");
    localStorage.setItem("user_"+name, JSON.stringify({ username: name, password: pass }));
    alert("Ro‘yxatdan o‘tdingiz!");
    closeSignup();
  }

  /* === Kirish === */
  window.login = function() {
    const name = document.getElementById("loginName").value.trim();
    const pass = document.getElementById("loginPass").value.trim();
    const u = JSON.parse(localStorage.getItem("user_"+name));
    if(u && u.password===pass) {
      currentUser = name;
      document.getElementById("chatScreen").classList.remove("hidden");
      closeLogin();
      loadMessages();
    } else {
      alert("Ism yoki parol noto‘g‘ri!");
    }
  }

  /* === Chiqish === */
  window.closeChat = function() {
    document.getElementById("chatScreen").classList.add("hidden");
    currentUser = null;
  }

  /* === Xabar yuborish === */
  window.sendMessage = async function() {
    const text = document.getElementById("messageInput").value.trim();
    if(!text || !currentUser) return;
    await addDoc(collection(db, "messages"), {
      user: currentUser,
      text,
      createdAt: serverTimestamp()
    });
    document.getElementById("messageInput").value = "";
  }

  /* === Xabarlarni real-time yuklash === */
  function loadMessages(){
    const q = query(collection(db, "messages"), orderBy("createdAt"));
    onSnapshot(q, snapshot=>{
      const messages = document.getElementById("messages");
      messages.innerHTML = "";
      snapshot.forEach(doc=>{
        const m = doc.data();
        const div = document.createElement("div");
        div.className = "flex " + (m.user===currentUser ? "justify-end" : "justify-start");
        div.innerHTML = `<div class="px-4 py-2 rounded-2xl max-w-xs ${m.user===currentUser?"bg-purple-600":"bg-gray-700"} text-white shadow">
          <strong>${m.user}</strong><br>${m.text}
        </div>`;
        messages.appendChild(div);
      });
      messages.scrollTop = messages.scrollHeight;
    });
  }

</script>
</body>
</html>
