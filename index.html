<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat va Foydalanuvchilar</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
  <h1 class="text-2xl font-bold mb-4">Chat Xonasi</h1>

  <!-- Chat oynasi -->
  <div id="messages" class="p-4 overflow-y-auto h-64 bg-gray-800 rounded"></div>

  <!-- Xabar yuborish -->
  <div class="flex mt-2">
    <input id="messageInput" type="text" placeholder="Xabar yozing..."
           class="flex-1 px-3 py-2 rounded-l text-black">
    <button id="sendBtn"
            class="bg-purple-600 px-4 py-2 rounded-r hover:bg-purple-700">Yubor</button>
  </div>

  <!-- Foydalanuvchilar ro'yxati -->
  <div id="usersList" class="p-4 bg-gray-800 text-white mt-6 rounded">
    <h2 class="font-bold mb-2">Foydalanuvchilar</h2>
    <ul id="users"></ul>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, doc, setDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ðŸ”‘ Firebase configni o'zingniki bilan almashtir
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT-ID.firebaseapp.com",
      projectId: "YOUR-PROJECT-ID",
      storageBucket: "YOUR-PROJECT-ID.appspot.com",
      messagingSenderId: "YOUR-SENDER-ID",
      appId: "YOUR-APP-ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ðŸ‘¤ Foydalanuvchi ismi
    const username = prompt("Ismingizni kiriting:") || "Noma'lum";

    // Foydalanuvchini ro'yhatga qo'shish
    const userRef = doc(db, "users", username);
    await setDoc(userRef, {
      name: username,
      joined: serverTimestamp()
    });

    // âœ‰ï¸ Xabar yuborish
    const sendBtn = document.getElementById("sendBtn");
    const messageInput = document.getElementById("messageInput");
    sendBtn.addEventListener("click", async () => {
      if (messageInput.value.trim() !== "") {
        await addDoc(collection(db, "messages"), {
          name: username,
          text: messageInput.value,
          time: serverTimestamp()
        });
        messageInput.value = "";
      }
    });

    // ðŸ“© Xabarlarni real vaqtda olish
    const messagesDiv = document.getElementById("messages");
    const q = query(collection(db, "messages"), orderBy("time"));
    onSnapshot(q, (snapshot) => {
      messagesDiv.innerHTML = "";
      snapshot.forEach((doc) => {
        const msg = doc.data();
        const p = document.createElement("p");
        p.innerHTML = `<strong>${msg.name}:</strong> ${msg.text}`;
        messagesDiv.appendChild(p);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // ðŸ‘¥ Foydalanuvchilar ro'yxati
    const usersList = document.getElementById("users");
    onSnapshot(collection(db, "users"), (snapshot) => {
      usersList.innerHTML = "";
      snapshot.forEach((doc) => {
        const li = document.createElement("li");
        li.textContent = doc.data().name;
        usersList.appendChild(li);
      });
    });
  </script>
</body>
</html>
